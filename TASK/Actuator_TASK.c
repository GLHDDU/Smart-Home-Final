#include "Actuator_TASK.h"
#include "FreeRTOS.h"
#include "task.h"
#include "time8.h"
#include "Lcd_TASK.h"
#include "led.h"
#include "delay.h"
#include "timer2.h"
#include "dht11.h"
#include "MQTT_TASK.h"
#include "step_motor.h"
#include "uart4.h"
#include "key.h"
#include <stdio.h>
#include "string.h"

#define N 600 

extern u8 tempdata,humidata;

extern User_Data_t User_Data;

vu8 key=0;	

int a[N+1],b[N+1],c[N+1];

int i,j;

int NUM,FLAG;

int fan,led1,led2,led3,led4,led5,led6,led7,curtain;

int arr[]={
	0,1,0,1,0,1,1,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,
  0,1,0,1,0,1,1,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,
  0,1,0,1,0,1,1,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,
	0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,10,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,
	0,1,0,1,1,1,1,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,
	1,0,1,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,10,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,
	0,1,0,1,1,1,1,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,
	0,1,0,1,0,1,1,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,
  0,1,0,1,0,1,1,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,
  0,1,0,1,0,1,1,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,
	0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,10,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,
	0,1,0,1,1,1,1,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,
};
int arrr[]={
	0,1,0,1,0,1,1,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,
  0,1,0,1,0,1,1,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,
  0,1,0,1,0,1,1,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,
	0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,10,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,
	0,1,0,1,1,1,1,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,
	1,0,1,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,10,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,
	0,1,0,1,1,1,1,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,
	0,1,0,1,0,1,1,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,
  0,1,0,1,0,1,1,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,
  0,1,0,1,0,1,1,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,
	0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,10,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,
	0,1,0,1,1,1,1,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,
	1,0,1,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,10,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,
	0,1,0,1,1,1,1,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,
	0,1,0,1,0,1,1,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,
};
int arrrr[]={
	0,1,0,1,0,1,1,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,
  0,1,0,1,0,1,1,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,
  0,1,0,1,0,1,1,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,
	0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,10,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,
	0,1,0,1,1,1,1,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,
	1,0,1,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,10,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,
	0,1,0,1,1,1,1,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,
	0,1,0,1,0,1,1,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,
  0,1,0,1,0,1,1,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,
  0,1,0,1,0,1,1,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,
	0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,10,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,
	0,1,0,1,1,1,1,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,
	1,0,1,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,10,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,
  0,1,0,1,1,1,0,	0,1,0,1,1,1,1,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,
	1,1,1,1,1,1,0,1,1,1,0,1,1,1,1,1,1,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,
	1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,
};
int arrrrr[]={
	0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
};
int arrrrrrrrr[]={
	0,1,0,1,1,1,1,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,
	0,1,0,1,0,1,1,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,
  0,1,0,1,0,1,1,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,
  0,1,0,1,0,1,1,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,
	0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,10,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,
};
int arrrrrr[]={
	0,1,0,1,0,1,1,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,
  0,1,0,1,0,1,1,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,
  0,1,0,1,0,1,1,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,
	0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,10,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,
	0,1,0,1,1,1,1,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,
	1,0,1,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,10,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,
	0,1,0,1,1,1,1,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,
	0,1,0,1,0,1,1,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,
  0,1,0,1,0,1,1,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,
  0,1,0,1,0,1,1,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,
	0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,10,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,
	0,1,0,1,1,1,1,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,
	1,0,1,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,10,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,
  0,1,0,1,1,1,0,	0,1,0,1,1,1,1,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,
	1,1,1,1,1,1,0,1,1,1,0,1,1,1,1,1,1,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,
	1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,
};

int arrrrrrr[]={
	400,500,100,400,800,800,800,900,600,700,800,800,700,799,795,651,852,123,789,256,
	252,900,811,555,745,888,800,800,800,800,800,888,800,800,800,800,800,888,800,800,
	400,500,100,400,800,800,800,900,600,700,800,800,700,799,795,651,852,123,789,256,
	252,900,811,555,745,888,800,800,800,800,800,888,800,800,800,800,800,888,800,800,
	585,522,700,900,750,800,799,800,800,500,500,788,625,735,425,875,899,654,800,800,
	800,452,792,758,258,245,655,879,545,521,564,216,248,895,888,800,800,800,600,400,
	200,750,358,565,785,485,165,725,465,755,858,465,400,500,100,400,800,800,800,900,
	600,700,800,800,700,799,795,651,852,123,789,256,800,800,800,800,800,800,800,800,
	252,900,811,555,745,888,800,800,800,800,800,888,800,800,800,800,800,888,800,800,
	400,500,100,400,800,800,800,900,600,700,800,800,700,799,795,651,852,123,789,256,
	252,900,811,555,745,888,800,800,800,800,800,888,800,800,800,800,800,888,800,800,
	585,522,700,900,750,800,799,800,800,500,500,788,625,735,425,875,899,654,800,800,
	800,452,792,758,258,245,655,879,545,521,564,216,248,895,888,800,800,800,600,400,
	200,750,358,565,785,485,165,725,465,755,858,465,800,800,800,800,800,888,800,800,
};
int arrrrrrrrrr[]={
	0,1,0,1,0,1,1,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,
  0,1,0,1,0,1,1,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,
  0,1,0,1,0,1,1,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,
	0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,10,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,	
};
int FindZhong(int * arr)
	
{
	 int data;
	
   for (i = 0; i < N; i++)
	
		b[i] = 0;
	
	 for (i = 0; i < N; i++)
	
	  a[i]=arr[i];
	
	 for (i = 0; i < N; i++)
	
	{
		
		for (j = i; j < N; j++)
		
		if (a[i] == a[j])
				
		b[i]++;		
		
	}
	
	  NUM = b[0];
	
	 for (i = 0; i < N; i++)
	{	
		
	  if (NUM <= b[i])
			
		{
			
			NUM = b[i];
			
			FLAG = i;
		}
		
	}							
	
	 for (i = 0; i < N; i++)
	
		c[i] = 0;
	
	 c[FLAG] = a[FLAG];
	
	 for (i = 0; i < N; i++)
	
	{
		
		if (NUM == b[i])
			
		c[i] = a[i];	
		
	}
	
	for (i = 0; i < N; i++)
	
		if (c[i]!=0)
			
		 data=c[i];	

     return data;

}	

int FindZhongZ(int * arr)
	
{
	
	 int data;
	
   for (i = 0; i < N; i++)
	
		b[i] = 0;
	
	 for (i = 0; i < N; i++)
	
	  a[i]=arr[i];
	
	 for (i = 0; i < N; i++)
	{
		
		for (j = i; j < N; j++)
		
		if (a[i] == a[j])
			
		b[i]++;	
		
	}
	
	NUM = b[0];
	
	for (i = 0; i < N; i++)
	{	
		
		if (NUM <= b[i])
			
		{
			
			NUM = b[i];
			
			FLAG = i;
			
		}
		
	}	
	
	for (i = 0; i < N; i++)
	
		c[i] = 0;
	
	c[FLAG] = a[FLAG];
	
	for (i = 0; i < N; i++)
	{
		
		if (NUM == b[i])
			
			c[i] = a[i];				
	}
	
	for (i = 0; i < N; i++)
	
		  data=c[i];	

     return data;

}


void Actuator_TASK(User_Data_t *User_Data)
{	
	
	printf("Actuator_TASK Start\r\n");
	
	while(1)
{	
	 LED0_ON;
	
	 delay_ms(500);
	
	 LED0_OFF;
	
	 DHT11_Read_Data(&tempdata,&humidata);	//¶ÁÈ¡ÎÂÊª¶ÈÖµ	
	
		if( strstr( (char*)UART4_RX_BUF,"xiaoming") )
	{
		fan=FindZhong(arrrrrrr);
		
		printf("fan:%d\r\n",fan);		
		 
		led1=FindZhongZ(arr);
		
		printf("led1:%d\r\n",led1); 
		 
		led2=FindZhong(arrr);
		
		printf("led2:%d\r\n",led2); 
		 
		led3=FindZhong(arrrr);
		
		printf("led3:%d\r\n",led3); 
		 
		led4=FindZhongZ(arrrrr);
		
		printf("led4:%d\r\n",led4); 
		 
		led5=FindZhong(arrrrrr);
		
		printf("led5:%d\r\n",led5); 
		 
		led6=FindZhong(arrrrrrrrr);
		
		printf("led6:%d\r\n",led6); 
		 
		led7=FindZhong(arrrrrrrrrr);
		
		printf("led7:%d\r\n",led7);
		
		curtain=FindZhongZ(arrrrr);
		
	  printf("curtain:%d\r\n",curtain);		

    if(fan==1)
		{
			
		TIM_SetCompare1(TIM2,899) ;	
			
		}
		
		
		else if(led1==1)
		{

		TIM_SetCompare2(TIM2, 400) ;	
			
	  User_Data->ledconf1=!User_Data->ledconf1;	
			
	  }	

		else if(led2==1)
		{

		TIM_SetCompare3(TIM2, 400) ;
			
	  User_Data->ledconf2=!User_Data->ledconf2;    		
			
	  }		
		
		else if(led3==1)
		{

		TIM_SetCompare4(TIM2, 400) ;	
		
		User_Data->ledconf3=!User_Data->ledconf3;  		
			
	  }	

		else if(led4==1)
		{

		GPIO_SetBits(GPIOG,GPIO_Pin_10);
		
		User_Data->ledconf4=!User_Data->ledconf4;
			
	  }	

		else if(led5==1)
		{

		GPIO_SetBits(GPIOG,GPIO_Pin_7);
		
    User_Data->ledconf1_2=!User_Data->ledconf1_2;
			
	  }	
		
		else if(led6==1)
		{

		GPIO_SetBits(GPIOG,GPIO_Pin_8);
		
    User_Data->ledconf2_2=!User_Data->ledconf2_2;
			
	  }

		else if(led7==1)
		{

	  GPIO_SetBits(GPIOG,GPIO_Pin_9);
		
    User_Data->ledconf3_2=!User_Data->ledconf3_2;
			
	  }	

		else if(curtain==1)
		{

		Stepturn(360,0);
		
		User_Data->curtain=!User_Data->curtain;
			
	  }			
  		
	
	}
	
	if( strstr( (char*)UART4_RX_BUF,"xiaomei") )
	{
    fan=FindZhongZ(arrrrrrr);
		
		printf("fanx:%d\r\n",fan);		
		 
		led1=FindZhongZ(arr);
		
		printf("led1x:%d\r\n",led1); 
		 
		led2=FindZhong(arrr);
		
		printf("led2x:%d\r\n",led2); 
		 
		led3=FindZhong(arrrr);
		
		printf("led3x:%d\r\n",led3); 
		 
		led4=FindZhong(arrrrr);
		
		printf("led4x:%d\r\n",led4); 
		 
		led5=FindZhongZ(arrrrrr);
		
		printf("led5x:%d\r\n",led5); 
		 
		led6=FindZhong(arrrrrrrrr);
		
		printf("led6x:%d\r\n",led6); 
		 
		led7=FindZhongZ(arrrrrrrrrr);
		
		printf("led7x:%d\r\n",led7);
		
		curtain=FindZhong(arrrrr);
		
	  printf("curtainx:%d\r\n",curtain);			

    if(fan==1)
		{
			
		TIM_SetCompare1(TIM2,899) ;	
			
		}
		
		
		else if(led1==1)
		{

		TIM_SetCompare2(TIM2, 400) ;	
			
	  User_Data->ledconf1=!User_Data->ledconf1;	
			
	  }	

		else if(led2==1)
		{

		TIM_SetCompare3(TIM2, 400) ;
			
	  User_Data->ledconf2=!User_Data->ledconf2;    		
			
	  }		
		
		else if(led3==1)
		{

		TIM_SetCompare4(TIM2, 400) ;	
		
		User_Data->ledconf3=!User_Data->ledconf3;  		
			
	  }	

		else if(led4==1)
		{

		GPIO_SetBits(GPIOG,GPIO_Pin_10);
		
		User_Data->ledconf4=!User_Data->ledconf4;
			
	  }	

		else if(led5==1)
		{

		GPIO_SetBits(GPIOG,GPIO_Pin_7);
		
    User_Data->ledconf1_2=!User_Data->ledconf1_2;
			
	  }	
		
		else if(led6==1)
		{

		GPIO_SetBits(GPIOG,GPIO_Pin_8);
		
    User_Data->ledconf2_2=!User_Data->ledconf2_2;
			
	  }

		else if(led7==1)
		{

	  GPIO_SetBits(GPIOG,GPIO_Pin_9);
		
    User_Data->ledconf3_2=!User_Data->ledconf3_2;
			
	  }	

		else if(curtain==1)
		{

		Stepturn(360,0);
		
		User_Data->curtain=!User_Data->curtain;
			
	  }			
  		
	
	}
	

	
	
	 	vTaskDelay(100);		
}

}







